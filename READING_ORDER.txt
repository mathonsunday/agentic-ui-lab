â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    REFACTORING ANALYSIS - READING ORDER            â•‘
â•‘                        (You are here â†’)                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you have 5 minutes:
  â†’ Read REFACTORING_SUMMARY.md
  
If you have 20 minutes:
  â†’ Read REFACTORING_SUMMARY.md (5 min)
  â†’ Read SYSTEM_PROMPT_REFACTORING.md (15 min)
  
If you have 45 minutes:
  â†’ Read REFACTORING_SUMMARY.md (5 min)
  â†’ Read SYSTEM_PROMPT_REFACTORING.md (15 min)
  â†’ Skim PROMPT_BUILDER_QUICK_START.md (20 min)
  
If you want the full picture:
  â†’ Read REFACTORING_SUMMARY.md (5 min)
  â†’ Read REFACTORING_ANALYSIS_2026.md (25 min)
  â†’ Read SYSTEM_PROMPT_REFACTORING.md (15 min)
  â†’ Read PROMPT_BUILDER_QUICK_START.md (20 min) when implementing

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ FILE GUIDE

REFACTORING_SUMMARY.md
â”œâ”€ What: Executive summary of all findings
â”œâ”€ Why: Understand the big picture quickly
â”œâ”€ Length: 5-10 minutes
â””â”€ Start here: Always, unless you're implementing

SYSTEM_PROMPT_REFACTORING.md
â”œâ”€ What: Deep dive into the prompt problem
â”œâ”€ Why: Understand WHY this is critical
â”œâ”€ Sections:
â”‚  â”œâ”€ The Problem (the 490 lines issue)
â”‚  â”œâ”€ Options 1-4 (4 ways to solve it)
â”‚  â”œâ”€ Recommended: Option 2 (Structured Prompt Builder)
â”‚  â””â”€ How it fits into overall plan
â”œâ”€ Length: 15 minutes
â””â”€ Read this: Before implementing prompt refactoring

PROMPT_BUILDER_QUICK_START.md
â”œâ”€ What: Step-by-step implementation guide
â”œâ”€ Why: You want to actually build this
â”œâ”€ Sections:
â”‚  â”œâ”€ File structure to create (6 new files)
â”‚  â”œâ”€ Code examples for each file
â”‚  â”œâ”€ Update existing files
â”‚  â”œâ”€ Test examples
â”‚  â””â”€ Verification steps
â”œâ”€ Length: 25 minutes (to understand structure)
â””â”€ Use this: When you're ready to code

REFACTORING_ANALYSIS_2026.md
â”œâ”€ What: Comprehensive codebase analysis
â”œâ”€ Why: Understand all refactoring opportunities
â”œâ”€ Sections:
â”‚  â”œâ”€ Executive summary (revised with prompt findings)
â”‚  â”œâ”€ 9 refactoring opportunities detailed
â”‚  â”œâ”€ Testing strategy & priorities
â”‚  â”œâ”€ Implementation roadmap (4 phases)
â”‚  â”œâ”€ Risk assessment
â”‚  â””â”€ Success metrics
â”œâ”€ Length: 45 minutes
â””â”€ Read this: When you want full context

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ WHAT CHANGED SINCE YOU ASKED

You asked: "What about system prompts? That huge wall of text controls 
          a lot of behavior"

Analysis found:
âœ— BEFORE: System prompts were not in original refactoring plan
âœ“ AFTER: Identified as HIGHEST PRIORITY (now Phase 1)

Why it's critical:
â”œâ”€ 490 lines of scattered, duplicated prompt code
â”œâ”€ Controls 90% of system behavior
â”œâ”€ Blocks personality tuning iteration
â”œâ”€ Not testable
â”œâ”€ Not discoverable
â””â”€ Changes most frequently (5 commits in 24 hours)

Solution:
â†’ Refactor to structured, composable prompt builder
â†’ Remove 275+ lines of duplication
â†’ Make personality tuning easy and discoverable
â†’ Enable testable, versionable personalities

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ QUICK START

To implement prompt refactoring this week:

1. Read SYSTEM_PROMPT_REFACTORING.md (understand options)
2. Read PROMPT_BUILDER_QUICK_START.md (understand structure)
3. Create directory: api/lib/prompts/
4. Create files from PROMPT_BUILDER_QUICK_START.md:
   â”œâ”€ types.ts
   â”œâ”€ sections/voiceExamples.ts
   â”œâ”€ sections/scoringRules.ts
   â”œâ”€ sections/contextInjection.ts
   â”œâ”€ sections/criticalMindset.ts
   â””â”€ systemPromptBuilder.ts
5. Add tests (examples in PROMPT_BUILDER_QUICK_START.md)
6. Update miraAgent.ts to use builder
7. Update analyze-user-stream.ts to use builder
8. Verify tests pass

Estimated time: 3-4 hours
Estimated impact: High (enables faster personality tuning)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â“ COMMON QUESTIONS

Q: Which document should I read first?
A: REFACTORING_SUMMARY.md (this orients you)

Q: What's the most important finding?
A: System prompts are the highest-priority refactoring
   (not the components you expected)

Q: When should I implement this?
A: This week (Phase 1, before other refactoring)

Q: Is this the complete refactoring plan?
A: No, this is Phase 1 of 4. See REFACTORING_ANALYSIS_2026.md
   for full plan, but prompt refactoring is most urgent.

Q: Should I do this before or after component extraction?
A: BEFORE. Higher ROI and enables faster iteration.

Q: Can I do this incrementally?
A: Yes. Build builder â†’ Test â†’ Swap miraAgent â†’ 
   Test â†’ Swap analyze-user-stream

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
